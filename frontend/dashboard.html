<!DOCTYPE html>
<html>
<head>
  <title>Dashboard</title>
  <link rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
</head>
<body class="container mt-5">

<h2>Dashboard</h2>

<input id="taskInput" class="form-control mb-2" placeholder="New task">
<button class="btn btn-primary mb-3" onclick="addTask()">Add Task</button>

<ul id="taskList" class="list-group mb-3"></ul>

<button class="btn btn-danger" onclick="logout()">Logout</button>

<script>
const token = localStorage.getItem("token")
if (!token) {
  window.location.href = "login.html"
}

async function fetchTasks() {
  const res = await fetch("http://localhost:5000/tasks", {
    headers: { Authorization: "Bearer " + token }
  })
  const tasks = await res.json()

  taskList.innerHTML = ""
  tasks.forEach(task => {
    taskList.innerHTML += `
      <li class="list-group-item d-flex justify-content-between">
        ${task.title}
        <button class="btn btn-sm btn-danger"
          onclick="deleteTask(${task.id})">X</button>
      </li>
    `
  })
}

async function addTask() {
  await fetch("http://localhost:5000/tasks", {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      Authorization: "Bearer " + token
    },
    body: JSON.stringify({ title: taskInput.value })
  })
  taskInput.value = ""
  fetchTasks()
}

async function deleteTask(id) {
  await fetch(`http://localhost:5000/tasks/${id}`, {
    method: "DELETE",
    headers: { Authorization: "Bearer " + token }
  })
  fetchTasks()
}

function logout() {
  localStorage.removeItem("token")
  window.location.href = "login.html"
}

fetchTasks()
</script>

</body>
</html>
